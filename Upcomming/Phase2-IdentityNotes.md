# Phase 2 – Identity, Staff & RBAC Progress Notes

## Completed (Jan 2025)
- **RBAC foundation**
  - Added Spatie Permission config + migrations (`database/migrations/2025_01_01_100000_create_permission_tables.php`, `config/permission.php`).
  - Database seeder seeds core roles (Admin, Manager, Technician, Staff, Auditor, ReadOnly) and baseline permissions: `staff.view`, `staff.create`, `staff.update`, `staff.delete`, `users.manage`.
  - Middleware aliases registered in `bootstrap/app.php`; Inertia shares roles/permissions via `HandleInertiaRequests`.
  - Frontend helper `PermissionGuard.vue` allows slot-based permission checks.
- **Staff module scaffolding**
  - `staff` table migration with basic profile fields; `App\Models\Staff` + factory + policy.
  - REST controller, form requests, and Inertia pages (`resources/js/pages/Staff/{Index,Create,Edit}.vue`) implement CRUD with glass UI.
  - Routes secured with permission middleware; navigation updated to expose Staff link.
  - Index page now mirrors Geraye UX: liquid-glass header, KPI chips, search + status filter toolbar, and permission-aware navigation entry.
- **User management**
  - Added `UserManagementController` with full CRUD, role/permission syncing, and staff linking.
  - New requests (`UserStoreRequest`, `UserUpdateRequest`) enforce guarded validation.
  - Inertia pages (`resources/js/pages/Users/{Index,Create,Edit}.vue`) replicate Geraye’s liquid-glass layout and provide dynamic assignment of roles, direct permissions, and staff associations.
  - Sidebar now surfaces Users nav for accounts with `users.manage`.

## Manual Testing
- `php artisan db:seed --class=RolePermissionSeeder` then `php artisan permission:cache-reset` to ensure roles own their permissions.
- Log in as `admin@example.com / password`; confirm Staff and Users nav entries appear.
- Staff module: exercise search + status filters, create/edit/delete flows, toast + confirm behaviour.
- Users module: create a user (with roles/permissions), link/unlink a staff profile, edit roles/permissions, delete a user (not self).
- Verify Inertia payload (`auth.permissions`, `auth.can`) updates immediately after role/permission changes.
- **Seed data**
  - `DatabaseSeeder` now creates an admin user (admin@example.com / random password generated by factory) with linked staff record.

## Still Outstanding
- Rebuild legacy user management UI (user CRUD, password resets, profile editing).
- Link staff to departments once taxonomy module exists (nullable `user_id` currently optional).

## Manual Test Checklist
1. **Role seeding** – run `php artisan migrate:fresh --seed` and confirm:
   - `roles` / `permissions` tables populated with the expected entries.
   - `admin@example.com` exists with `Admin` role (default password: `password`).
2. **Login & navigation**
   - Sign in as admin, ensure sidebar shows “Staff”.
   - Visiting `/staff` lists seeded admin profile.
3. **CRUD operations**
   - Create a new staff member (leave `hire_date` blank, try with date).
   - Edit the record (change status/phone) and verify toast confirmation.
   - Delete the record; confirm confirm-modal appears and list updates.
4. **Permissions**
   - Temporarily assign a non-privileged role (e.g., `ReadOnly`) to a user and verify create/edit/delete actions disappear and routes are blocked with 403.

Log any issues or UX gaps back in `Upcomming/GerayeFeatureMigrationTasks.md` so the checklist stays authoritative.


